#!/usr/bin/env python
# coding: utf-8

# <div class="alert alert-info">
# <font size="4"><b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
#     –ü—Ä–∏–≤–µ—Ç, –°–µ—Ä–≥–µ–π! –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø—Ä–∏—Å–ª–∞–ª –∑–∞–¥–∞–Ω–∏–µ :) <br>–ú–µ–Ω—è –∑–æ–≤—É—Ç –ù–∏–∫–∏—Ç–∞ –°–æ–Ω –∏ —è –±—É–¥—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç. –ü—Ä–µ–¥–ª–∞–≥–∞—é –æ–±—Ä–∞—â–∞—Ç—å—Å—è –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É –Ω–∞ —Ç—ã, –∫–∞–∫ —ç—Ç–æ –ø—Ä–∏–Ω—è—Ç–æ –≤ –ü—Ä–∞–∫—Ç–∏–∫—É–º–µ, –µ—Å–ª–∏ —Ç—ã –Ω–µ –ø—Ä–æ—Ç–∏–≤. –ù–æ –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –Ω–∞ –í—ã - –Ω–µ –±—É–¥—É –≤–æ–∑—Ä–∞–∂–∞—Ç—å üôÇ
#         
# –ü–æ–µ—Ö–∞–ª–∏ üöÄ
#     <br />
# 
# –ú–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ–±–æ–∑–Ω–∞—á–µ–Ω—ã –ø–æ–º–µ—Ç–∫–æ–π <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b>. –ü—Ä–∏ –≤–Ω–µ—Å–µ–Ω–∏–∏ –ø—Ä–∞–≤–æ–∫ –≤ –ø—Ä–æ–µ–∫—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –º–µ–Ω—è–π –∏ –Ω–µ —É–¥–∞–ª—è–π –∏—Ö —Ç.–∫. –¥–∞–ª—å–Ω–µ–π—à–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ —Ç–æ–º —á–∏—Å–ª–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≥–æ, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∑–∞–º–µ—á–∞–Ω–∏—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∏–ª–∏ –Ω–µ—Ç. –ó–∞—Ç–æ —Ç—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—à—å –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –º–µ–Ω—è :)
#     </font>
# </div>
# 
# <div class="alert alert-success">
# <font size="4"><b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –í –∑–µ–ª—ë–Ω—ã—Ö –±–ª–æ–∫–∞—Ö –±—É–¥—É—Ç –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
# <br />
#     </font>
# </div>
# 
# <div class="alert alert-warning">
# <font size="4"><b>‚ö†Ô∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –í –∂—ë–ª—Ç—ã—Ö - –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è
#     </font>
# </div>
# 
# <div class="alert alert-danger">
# <font size="4"><b>‚ùå –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br /> 
# –í –∫—Ä–∞—Å–Ω—ã—Ö - –≤–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å
#     </font>
# </div>
# 
# <div class="alert alert-info">
# <font size="4">üçï<b> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br /> 
# –í —Å–∏–Ω–∏—Ö —Å –ø–∏—Ü—Ü–µ–π - —Ä–∞–∑–ª–∏—á–Ω—ã–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —Å–æ–≤–µ—Ç—ã –Ω–∞ –±—É–¥–µ—â–µ–µ –∏ –ø—Ä–æ—á–µ–µ.
#     </font>
# </div>

# # –í—ã–±–æ—Ä –ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è —Å–∫–≤–∞–∂–∏–Ω—ã

# –î–æ–ø—É—Å—Ç–∏–º, –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –≤ –¥–æ–±—ã–≤–∞—é—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ ¬´–ì–ª–∞–≤–†–æ—Å–ì–æ—Å–ù–µ—Ñ—Ç—å¬ª. –ù—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å, –≥–¥–µ –±—É—Ä–∏—Ç—å –Ω–æ–≤—É—é —Å–∫–≤–∞–∂–∏–Ω—É.
# 
# –í–∞–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±—ã –Ω–µ—Ñ—Ç–∏ –≤ —Ç—Ä—ë—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö: –≤ –∫–∞–∂–¥–æ–º 10 000 –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–π, –≥–¥–µ –∏–∑–º–µ—Ä–∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–µ—Ñ—Ç–∏ –∏ –æ–±—ä—ë–º –µ—ë –∑–∞–ø–∞—Å–æ–≤. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–≥–∏–æ–Ω, –≥–¥–µ –¥–æ–±—ã—á–∞ –ø—Ä–∏–Ω–µ—Å—ë—Ç –Ω–∞–∏–±–æ–ª—å—à—É—é –ø—Ä–∏–±—ã–ª—å. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω—É—é –ø—Ä–∏–±—ã–ª—å –∏ —Ä–∏—Å–∫–∏ —Ç–µ—Ö–Ω–∏–∫–æ–π *Bootstrap.*
# 
# –®–∞–≥–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª–æ–∫–∞—Ü–∏–∏:
# 
# - –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ –∏—â—É—Ç –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤;
# - –°—Ç—Ä–æ—è—Ç –º–æ–¥–µ–ª—å –∏ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç –æ–±—ä—ë–º –∑–∞–ø–∞—Å–æ–≤;
# - –í—ã–±–∏—Ä–∞—é—Ç –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è —Å —Å–∞–º—ã–º –≤—ã—Å–æ–∫–∏–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏–π. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–π –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±—é–¥–∂–µ—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–π —Å–∫–≤–∞–∂–∏–Ω—ã;
# - –ü—Ä–∏–±—ã–ª—å —Ä–∞–≤–Ω–∞ —Å—É–º–º–∞—Ä–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏ –æ—Ç–æ–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–π.

# ## –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

# In[5]:


import pandas as pd 
import seaborn as sns
import numpy as np
from scipy import stats as st
import matplotlib.pyplot as plt
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error


# In[6]:


df_0 = pd.read_csv('/datasets/geo_data_0.csv')
display(df_0.head())
df_0.info()


# In[7]:


df_1 = pd.read_csv('/datasets/geo_data_1.csv')
display(df_1.head())
df_1.info()


# In[8]:


df_2 = pd.read_csv('/datasets/geo_data_2.csv')
display(df_2.head())
df_2.info()


# –í —Ç–∞–±–ª–∏—Ü–∞—Ö –ø–æ 5 —Å—Ç–æ–ª–±—Ü–æ–≤. –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö ‚Äî —Å—Ç—Ä–æ–∫–∏ –∏ –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞, –ø—Ä–æ–ø—É—Å–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
# 
# –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫ –¥–∞–Ω–Ω—ã–º:
#     -id ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–∫–≤–∞–∂–∏–Ω—ã;
#     -f0, f1, f2 ‚Äî —Ç—Ä–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞ —Ç–æ—á–µ–∫
#     -product ‚Äî –æ–±—ä—ë–º –∑–∞–ø–∞—Å–æ–≤ –≤ —Å–∫–≤–∞–∂–∏–Ω–µ (—Ç—ã—Å. –±–∞—Ä—Ä–µ–ª–µ–π).

# In[9]:


print(df_0.duplicated().sum())
print(df_1.duplicated().sum())
print(df_2.duplicated().sum())


# –ü–æ–ª–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

# In[10]:


print( df_0['id'].duplicated().sum())
print(df_1['id'].duplicated().sum())
print( df_2['id'].duplicated().sum())


# –î—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç, —É –Ω–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π id, –Ω–æ —Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –¢.–∫ –∏—Ö –¥–æ–ª—è –æ—á–µ–Ω—å –º–∞–ª–∞, –º–æ–∂–µ–º —É–¥–∞–ª–∏—Ç—å —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è:

# In[11]:


df_0 = df_0.drop_duplicates(subset=['id'])
df_1 = df_1.drop_duplicates(subset=['id'])
df_2 = df_2.drop_duplicates(subset=['id'])


# <div class="alert alert-success">
# <font size="4"><b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –ú–æ–ª–æ–¥–µ—Ü, —á—Ç–æ –æ–±–Ω–∞—Ä—É–∂–∏–ª –Ω–µ—è–≤–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã. –≠—Ç–æ –¥–µ–ª–∞—é—Ç –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ.

# ## –û–±—É—á–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏

# –° –ø–æ–º–æ—â—å—é —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –≤–∑–∞–∏–º–æ—Å–≤—è–∑—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:

# In[12]:


sns.heatmap(df_0.corr(), annot=True, square=True)
plt.title('–í–∑–∞–∏–º–æ—Å–≤—è–∑—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_0')
plt.show() 


# In[13]:


sns.heatmap(df_1.corr(), annot=True, square=True)
plt.title('–í–∑–∞–∏–º–æ—Å–≤—è–∑—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_1')
plt.show()


# In[14]:


sns.heatmap(df_2.corr(), annot=True, square=True)
plt.title('–í–∑–∞–∏–º–æ—Å–≤—è–∑—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_2')
plt.show() 


# –î–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_1 –≤–∏–¥–∏–º —Å—Ç—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ –æ—Ç f2 —Ä–∞–≤–Ω–æ–µ –µ–¥–∏–Ω–∏—Ü–µ, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–æ –æ—à–∏–±–∫–æ–π –≤ –¥–∞–Ω–Ω—ã—Ö. –ó–Ω–∞—á–µ–Ω–∏—è –∂–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –¥–ª—è —Ä–µ–≥–∏–æ–Ω–æ–≤ geo_data_0 –∏ geo_data_2 –ø–æ—Ö–æ–∂–∏, –≤ –Ω–∞–∏–±–æ–ª—å—à–µ–π —Å—Ç–µ–ø–µ–Ω–∏ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫ product –≤–ª–∏—è–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫ f2

# <div class="alert alert-success">
# <font size="4"><b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ - –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å EDA —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, –≤–µ–¥—å –ø–æ —É—Å–ª–æ–≤–∏—é –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–∏–Ω–µ–π–Ω—É—é –º–æ–¥–µ–ª—å –∏ –Ω–∞–º –≤–∞–∂–Ω–æ –Ω–µ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å –ø—Ä–æ–±–ª–µ–º–æ–π –º—É–ª—å—Ç–∏–∫–æ–ª–ª–∏–Ω–µ–∞—Ä–Ω–æ—Å—Ç–∏.

# ### –†–∞–∑–±–∏–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—ã–±–æ—Ä–∫–∏ –∏ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ 

# In[15]:


model = LinearRegression()


# –†–∞–∑–±–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤—ã–±–æ—Ä–∫–∏ –∏ –ø–æ–ª—É—á–∞—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –∏ RMSE –±—É–¥–µ–º —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏:

# In[16]:


def predictions_rmse(df):
    features = df.drop(['id', 'product'], axis = 1)
    target = df['product']
    features_train, features_valid, target_train, target_valid = train_test_split(features, target, test_size=0.25, random_state=12345)
    model.fit(features_train, target_train)
    predicted_valid = model.predict(features_valid)
    rmse = (mean_squared_error(target_valid, predicted_valid))**0.5
    print('—Å—Ä–µ–¥–Ω–∏–π –∑–∞–ø–∞—Å —Å—ã—Ä—å—è –≤ —Ä–µ–≥–∏–æ–Ω–µ: ', predicted_valid.mean())
    print('RMSE: ', rmse)
    return predicted_valid, target_valid


# <div class="alert alert-success">
# <font size="4"><b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –ú–æ–ª–æ–¥–µ—Ü, —á—Ç–æ –æ—Ñ–æ—Ä–º–∏–ª –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–µ–π. –≠—Ç–æ –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ —Ö–æ—Ä–æ—à–∏–π –ø–æ–¥—Ö–æ–¥, –∞ –∫–æ–≥–¥–∞ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç - –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞–¥ —Å—Ö–æ–∂–∏–º–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞–º–∏ - —ç—Ç–æ —Ç–µ–º –±–æ–ª–µ–µ —Ä–∞–∑—É–º–Ω–æ.

# <div class="alert alert-info">
# <font size="4">üçï<b> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –†–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞, —Ç–∞–∫–∏–µ –∫–∞–∫ —Ä–∞–Ω–¥–æ–º —Å—Ç–µ–π—Ç, —Å—Ç–æ–∏—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –æ–ø–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–∂–µ –∏–º–∏, –∞ –Ω–µ —á–∏—Å–ª–∞–º–∏

# In[17]:


print('–î–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_0:')
predicted_0, target_0 = predictions_rmse(df_0)
print('------------------')
print('–î–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_1:')
predicted_1, target_1 = predictions_rmse(df_1)
print('------------------')
print('–î–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_2:')
predicted_2, target_2 = predictions_rmse(df_2)


# <div class="alert alert-success">
# <font size="4"><b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –ü–æ–ª—É—á–µ–Ω—ã –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏

# –ù–∞–∏–º–µ–Ω—å—à—É—é RMSE –≤–∏–¥–∏–º –≤ —Ä–µ–≥–∏–æ–Ω–µ geo_data_1, –Ω–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Ç–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –≤—ã—à–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞ f2. –°—Ä–µ–¥–Ω–∏–π –∑–∞–ø–∞—Å —Å—ã—Ä—å—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≤ —Ä–µ–≥–∏–æ–Ω–∞—Ö geo_data_0 –∏ geo_data_1, –Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ RMSE –∑–¥–µ—Å—å –æ—á–µ–Ω—å –≤–µ–ª–∏–∫–æ.

# ## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞—Å—á—ë—Ç—É –ø—Ä–∏–±—ã–ª–∏

# In[18]:


POINTS_NUM = 500       # –æ–±—â–µ–µ —á–∏—Å–ª–æ —Å–∫–≤–∞–∂–∏–Ω –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
BEST_POINTS_NUM = 200  # —á–∏—Å–ª–æ —Å–∫–≤–∞–∂–∏–Ω –≤ –æ–¥–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
BUDGET = 10*(10**9)   # –±—é–¥–∂–µ—Ç –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å–∫–≤–∞–∂–∏–Ω –≤ —Ä–µ–≥–∏–æ–Ω–µ
INCOME = 450000        # –¥–æ—Ö–æ–¥ —Å –∫–∞–∂–¥–æ–π –µ–¥–∏–Ω–∏—Ü—ã –ø—Ä–æ–¥—É–∫—Ç–∞
RISK_MAX = 0.025       # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–±—ã—Ç–∫–æ–≤


# –†–∞—Å—Å—á–∏—Ç–∞–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –æ–±—ä—ë–º —Å—ã—Ä—å—è –¥–ª—è –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ–π —Å–∫–≤–∞–∂–∏–Ω—ã:

# In[19]:


BUDGET / BEST_POINTS_NUM / INCOME


# In[28]:


print('–°—Ä–µ–¥–Ω–∏–π –∑–∞–ø–∞—Å –Ω–µ—Ñ—Ç–∏ –Ω–∞ —Å–∫–≤–∞–∂–∏–Ω—É –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º:')
print('geo_data_0', df_0['product'].mean())
print('geo_data_1', df_1['product'].mean())
print('geo_data_2', df_2['product'].mean())


# <div class="alert alert-success">
# <font size="4"><b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –†–∞—Å—á—ë—Ç –≤–µ—Ä–Ω—ã–π

# <div class="alert alert-info">
# <font size="4">üçï<b> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –ü—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã —è—á–µ–π–∫–∏ –∫–æ–¥–∞ - –Ω–µ –æ—á–µ–Ω—å. –°—Ç–æ–∏—Ç –≤—ã–≤–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —á—Ç–æ —ç—Ç–æ –∑–∞ —á–∏—Å–ª–æ –∏ –≤ –∫–∞–∫–∏—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö –∏–∑–º–µ—Ä–µ–Ω–∏—è.

# –°–æ–≥–ª–∞—Å–Ω–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –≤—ã—à–µ –∑–Ω–∞—á–µ–Ω–∏—è–º —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–∞–ø–∞—Å–∞ —Å—ã—Ä—å—è –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º, –Ω–∏ –≤ –æ–¥–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ –Ω–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –Ω–æ –ø–æ —É—Å–ª–æ–≤–∏—é –∑–∞–¥–∞—á–∏ –Ω—É–∂–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å 500 —Å–∫–≤–∞–∂–∏–Ω –∏ –≤—ã–±—Ä–∞—Ç—å 200 –ª—É—á—à–∏—Ö. –î–ª—è —ç—Ç–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–∏–º —Ñ—É–Ω–∫—Ü–∏—é income_calc:

# In[20]:


def income_calc(target, predicted):
    target = pd.Series(target).reset_index(drop=True)
    predicted = pd.Series(predicted).reset_index(drop=True)
    pred_sorted = predicted.sort_values(ascending=False)
    selected = target[pred_sorted.index][:BEST_POINTS_NUM]
    return INCOME * selected.sum() - BUDGET


# <div class="alert alert-success">
# <font size="4"><b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –ù–µ –∑–Ω–∞—é –¥–æ–≥–∞–¥–∞–ª—Å—è —Ç—ã –∫–∞–∫-—Ç–æ —Å–∞–º –∏–ª–∏ –∫—Ç–æ-—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞–ª —Ç–µ–±–µ –æ–± —ç—Ç–æ–º —Ç–æ–Ω–∫–æ–º –º–æ–º–µ–Ω—Ç–µ —Ä–∞–±–æ—Ç—ã (—Å–∫–ª–æ–Ω—è—é—Å—å –∫–æ –≤—Ç–æ—Ä–æ–º—É –≤–∞—Ä–∏–∞–Ω—Ç—É), –Ω–æ —Å–±—Ä–æ—Å –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏ —Ç–µ–±–µ –ø–æ–º–æ–≥ –∏–∑–±–µ–∂–∞—Ç—å –∫—Ä–∞—Å–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è. –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –ø–æ–∫–∞–∂—É —á—Ç–æ –±—ã –±—ã–ª–æ –±–µ–∑ –Ω–µ–≥–æ –Ω–∞ –º–∏–∫—Ä–æ–ø—Ä–∏–º–µ—Ä–µ:

# In[21]:


# –ö–û–î –†–ï–í–¨–Æ–ï–†–ê
# –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π –¥–∞—Ç–∞—Å–µ—Ç –∏–∑ 1 —ç–ª–µ–º–µ–Ω—Ç–∞ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–Ω–Ω–æ–π –∏ —Å–æ–æ—Ç–≤. 1 –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
_target = pd.DataFrame({'target': [1]})
_preds = pd.DataFrame({'pred': [1]})

print("–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:")
display(_preds)
display(_target)

# —Å–¥–µ–ª–∞–µ–º –±—É—Ç—Å—Ç—Ä–∞–ø–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã–±–æ—Ä–∫—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —Ä–∞–∑–º–µ—Ä–∞ 2 –∏ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º –≤–æ–∑—å–º—ë–º —Å–æ–æ—Ç–≤. —Ç–∞—Ä–≥–µ—Ç—ã
preds_bs = _preds.sample(n=2, replace=True)
target_bs = _target.loc[preds_bs.index]

print("–ü–æ—Å–ª–µ —Å—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏—è:")
display(preds_bs)
display(target_bs)

# –¥–æ–ø—É—Å—Ç–∏–º, –Ω–∞–º –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å 2 –ª—É—á—à–∏–µ –ø–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è–º —Ç–æ—á–∫–∏ –∏ –ø–æ—Å—á–∏—Ç–∞—Ç—å –≤ –Ω–∏—Ö –ø—Ä–∏–±—ã–ª—å
preds_sorted = preds_bs.sort_values('pred', ascending=False)
target_selected = target_bs.loc[preds_sorted[:2].index]

print("–ü–æ—Å–ª–µ –æ—Ç–±–æ—Ä–∞ –ª—É—á—à–∏—Ö —Ç–æ—á–µ–∫:")
display(preds_sorted)
display(target_selected)


# <div class="alert alert-success">
# <font size="4"></font>
#     <font size="3", color = "black">
# –ò —Ç–∞–∫–∂–µ –±—ã —Å—Ç–∞–ª–∏ –º–Ω–æ–∂–∏—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã –≤—ã–±–æ—Ä–æ–∫ —É —Ç–µ–±—è. –ü–æ—á–µ–º—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π 2, –∞ —Ç–∞—Ä–≥–µ—Ç–æ–≤ 4? –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, –≤—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ. –ö–æ–≥–¥–∞ –º—ã –ø–æ–ø—Ä–æ—Å–∏–ª–∏ —É –ø–∞–Ω–¥–∞—Å–∞ –≤–∑—è—Ç—å —Ç–∞—Ä–≥–µ—Ç—ã –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π, –∏ —É –Ω–∞—Å –∏ —Ç–∞–º –∏ —Ç–∞–º 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞, –æ–Ω –æ—Ç–Ω—é–¥—å –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –Ω–µ 2. –û–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –≤—ã–¥–∞—ë—Ç –≤—Å–µ —Ç–∞—Ä–≥–µ—Ç—ã —Å —Ç–∞–∫–∏–º –∏–Ω–¥–µ–∫—Å–æ–º. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã –∑–∞–ø—Ä–æ—Å–∏–ª–∏ 2 —Ä–∞–∑–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º 0 - –æ–±–∞ —Ä–∞–∑–∞ –ø–∞–Ω–¥–∞—Å –æ—Ç–¥–∞–ª –Ω–∞–º 2 —Ç–∞–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Ç–∞—Ä–≥–µ—Ç–æ–≤ - –≤—Å–µ–≥–æ 4 —ç–ª–µ–º–µ–Ω—Ç–∞. –ê –µ—Å–ª–∏ –±—ã —É –Ω–∞—Å –±—ã–ª–æ –∏ —Ç–∞–º, –∏ —Ç–∞–º –ø–æ 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞, —Ç–æ –≤ –∏—Ç–æ–≥–µ –±—ã–ª–æ –±—ã 9. –õ–æ–≥–∏–∫–∞, –Ω–∞–¥–µ—é—Å—å, —è—Å–Ω–∞.<br>
# 
# –°–±—Ä–æ—Å –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–∏ —ç—Ç–æ–º - –Ω–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã. –ü—Ä–æ—â–µ –±—ã–ª–æ –±—ã –ø–æ—Å—Ç—É–ø–∏—Ç—å —Ç–∞–∫: –≤ —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–∏–±—ã–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å —Å—ç–º–ø–ª –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∏ —Ç–∞—Ä–≥–µ—Ç (–Ω–µ —Å—ç–º–ø–ª —Ç–∞—Ä–≥–µ—Ç–æ–≤, –∞ –∏—Å—Ö–æ–¥–Ω—ã–π, –ø–æ–ª–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–∞—Ä–≥–µ—Ç, 25000 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –Ω–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è –∏–Ω–¥–µ–∫—Å–∞–º–∏), –∏ —Ç–æ–≥–¥–∞ –ø–æ–ª—É—á–∏–ª–æ—Å—å –±—ã, —á—Ç–æ –º—ã —Å—ç–º–ø–ª–∏—Ä—É–µ–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö, –≤—ã–±–∏—Ä–∞–µ–º 200 –ª—É—á—à–∏—Ö, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ –∏—Ö –∏–Ω–¥–µ–∫—Å–∞–º –±–µ—Ä—ë–º —Ç–∞—Ä–≥–µ—Ç—ã. –ù–æ –ø–æ—Å–∫–æ–ª—å–∫—É —Ç–∞—Ä–≥–µ—Ç—ã –±—ã –±—ã–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–µ, —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏, —Ç–æ –∑–∞–ø—Ä–æ—Å–∏–≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏–Ω–¥–µ–∫—Å 2 —Ä–∞–∑–∞, –º—ã –±—ã –≤ –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–∏–ª–∏ 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞, –∞ –Ω–µ 4, –æ—à–∏–±–∫–∏ –±—ã –Ω–µ –±—ã–ª–æ.

# ## –†–∞—Å—á—ë—Ç –ø—Ä–∏–±—ã–ª–∏ –∏ —Ä–∏—Å–∫–æ–≤ 

# In[22]:


check = income_calc(target_0, predicted_0)
check


# In[23]:


check = income_calc(target_1, predicted_1)
check


# In[24]:


check = income_calc(target_2, predicted_2)
check


# <div class="alert alert-warning">
# <font size="4"><b>‚ö†Ô∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —ç—Ç–∏—Ö 3 –ø—Ä–∏–±—ã–ª–µ–π - —à–∞–≥ —Ö–æ—Ä–æ—à–∏–π, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤—ã–≤–æ–¥–∞ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –Ω–∞–≤–µ—Ä–Ω–æ–µ –Ω–µ –æ—á–µ–Ω—å –ø–æ–Ω–∏–º–∞–µ—à—å –≤ —á—ë–º –µ–≥–æ —Ö–æ—Ä–æ—à–µ—Å—Ç—å. –ú—ã —Å–µ–π—á–∞—Å –≤–∏–¥–∏–º, —á—Ç–æ –≤–æ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –ø—Ä–∏–±—ã–ª—å. –ê –≤—ã–≤–æ–¥, —á—Ç–æ –∫–∞–∂–¥—ã–π —Ä–µ–≥–∏–æ–Ω –∏–º–µ–µ—Ç –ø—Ä–∏–±—ã–ª—å, –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, –¥–ª—è –Ω–∞—Å –æ—á–µ–Ω—å –≤–∞–∂–µ–Ω.<br>
# 
# –î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –Ω–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ, –∫–æ–≥–¥–∞ –º—ã –µ—â—ë –Ω–µ –∑–Ω–∞–µ–º —á—Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –±—É—Ç—Å—Ç—Ä–∞–ø–∞, –º—ã —É–∂–µ –º–æ–∂–µ–º –æ—Ü–µ–Ω–∏—Ç—å –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –Ω–∞—Å –º–æ–∂–µ—Ç –∂–¥–∞—Ç—å. –†–∞–Ω–µ–µ –º—ã —Å—Ä–∞–≤–Ω–∏–ª–∏ —Å—Ä–µ–¥–Ω–∏–µ –∑–∞–ø–∞—Å—ã —Ä–µ–≥–∏–æ–Ω–æ–≤ —Å —Ç–æ—á–∫–æ–π –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏, –∏ —É–≤–∏–¥–µ–ª–∏, —á—Ç–æ –∫–∞–∂–¥—ã–π —Ä–µ–≥–∏–æ–Ω –≤ —Å—Ä–µ–¥–Ω–µ–º —É–±—ã—Ç–æ—á–µ–Ω. –ï—Å–ª–∏ –±—ã –º—ã –∏ –∑–¥–µ—Å—å —É–≤–∏–¥–µ–ª–∏ —É–±—ã—Ç–∫–∏, —Ç–æ –¥–∞–ª—å–Ω–µ–π—à–∞—è —Ä–∞–±–æ—Ç–∞ –±—ã–ª–∞ –±—ã –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ–π. –ó–∞—á–µ–º –Ω–∞–º —á—Ç–æ-—Ç–æ —Å—á–∏—Ç–∞—Ç—å, –µ—Å–ª–∏ —É –Ω–∞—Å –¥–∞–∂–µ –≤ –ª—É—á—à–µ–º —Å–ª—É—á–∞–µ —É–±—ã—Ç–æ–∫? –ê —Ä–∞–∑ —É –Ω–∞—Å –≤–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–∏–±—ã–ª—å, —Ç–æ —Å–º—ã—Å–ª –µ—Å—Ç—å, –º—ã –¥–µ–ª–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é –æ—Å–º—ã—Å–ª–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É, –Ω–∞—à–∞ –º–æ–¥–µ–ª—å –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–∞.<br>
# 
# –í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –≤–∞–∂–Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ –ø–æ–Ω—è—Ç—å –¥–≤–∏–∂–µ–º—Å—è –ª–∏ –º—ã –≤ –≤–µ—Ä–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∏–ª–∏ –Ω–∞–¥–æ —á—Ç–æ-—Ç–æ –º–µ–Ω—è—Ç—å. –ü–æ—Ç–æ–º—É —á—Ç–æ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –∏ –¥–µ–Ω—å–≥–∏ –≤–ø—É—Å—Ç—É—é - –Ω–µ –ª—É—á—à–∞—è –∑–∞—Ç–µ—è.

# –î–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–∏–º —Ñ—É–Ω–∫—Ü–∏—é bootstrap:

# In[25]:


def bootstrap(target, predicted):
    state = np.random.RandomState(12345)
    values = []
    for i in range(1000):
        target_subsample = target.reset_index(drop=True).sample(n=POINTS_NUM, replace=True, random_state=state)
        predicted = pd.Series(predicted)
        pred_subsample = predicted[target_subsample.index]
        res = income_calc(target_subsample, pred_subsample)
        values.append(res)
    values = pd.Series(values)

    lower = values.quantile(.025)
    upper = values.quantile(.975)
    mean = values.mean() 
    risks = (values < 0).mean() * 100   
    print('–°—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞:', round(mean/1000000), '–º–ª–Ω.—Ä.')
    print('2.5%-–∫–≤–∞–Ω—Ç–∏–ª—å:', round(lower/1000000), '–º–ª–Ω.—Ä')
    print('–î–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª:  –æ—Ç', round(lower/1000000), '–¥–æ', round(upper/1000000), '–º–ª–Ω.—Ä')
    print('B–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–±—ã—Ç–∫–æ–≤:', risks, '%')
    ax=values.plot(kind='hist', bins=12, grid=True)  
    ax.set_xlabel('–ü—Ä–∏–±—ã–ª—å, –º–ª–Ω.—Ä—É–±.', fontsize=13)
    plt.show()


# In[26]:


print('–î–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_0:')
bootstrap(target_0, predicted_0)
print('--------------')
print('–î–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_1:')
bootstrap(target_1, predicted_1)
print('--------------')
print('–î–ª—è —Ä–µ–≥–∏–æ–Ω–∞ geo_data_2:')
bootstrap(target_2, predicted_2)


# <div class="alert alert-info">
# <font size="4">üçï<b> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ã–ª–æ –±—ã –Ω–µ–ø–ª–æ—Ö–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –≤–µ–¥—å –æ–Ω–∏ - —Ç–æ, —Ä–∞–¥–∏ —á–µ–≥–æ –≤—Å—è —Ä–∞–±–æ—Ç–∞ –¥–µ–ª–∞–ª–∞—Å—å. –î–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥–æ–π–¥—É—Ç —è—â–∏–∫–∏ —Å —É—Å–∞–º–∏ –∏–ª–∏ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –≤—ã–±–æ—Ä–æ—á–Ω—ã—Ö –ø—Ä–∏–±—ã–ª–µ–π —Å –Ω–∞–Ω–µ—Å—ë–Ω–Ω—ã–º–∏ –Ω–∞ –Ω–∏—Ö –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–æ–≤. –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤.

# –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤ –æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω—É—é –≥—Ä–∞–Ω–∏—Ü—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É–±—ã—Ç–∫–æ–≤ –º–µ–Ω–µ–µ 2.5% –ø–æ–ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏–æ–Ω geo_data_1. –¢–∞–∫–∂–µ —ç—Ç–æ—Ç —Ä–µ–≥–∏–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∏–±–æ–ª—å—à—É—é —Å—Ä–µ–¥–Ω—é—é –≤—ã—Ä—É—á–∫—É –≤ 478 –º–ª–Ω.—Ä.

# <div class="alert alert-success">
# <font size="4"><b>‚úîÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />    
# –ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ –æ–±—Ä–∞—Ç–∏–ª –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–æ, —á—Ç–æ –≤ –¥–∞–Ω–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ —Å–∞–º—ã–π –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫, –Ω–æ –∏ –ª—É—á—à–∞—è —Å—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–≤–æ—ë —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–µ –º–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–µ–µ.

# ----

# <div class="alert alert-info">
# <font size="4">üçï<b> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞</b></font>
#     <br /> 
#     <font size="3", color = "black">
# <br />
# –í —Ü–µ–ª–æ–º –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –Ω–µ–±–æ–ª—å—à–∞—è –ø—Ä–∞–≤–∫–∞: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å –∏—Å—Ç–∏–Ω–Ω—ã–º–∏ —Å—Ä–µ–¥–Ω–∏–º–∏ –∏ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ—á–µ–º—É –∏—Å—Ç–∏–Ω–Ω—ã–µ –≤–æ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –±–ª–∏–∑–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º, –∏ –ø—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–∏–Ω—è—Ç–∏—é.

# –î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä, –¥–æ–±–∞–≤–∏–ª —Ä–∞—Å—á–µ—Ç –∏—Å—Ç–∏–Ω–Ω—ã—Ö —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é –Ω–µ –ø–æ–Ω–∏–º–∞—é –ø–æ—á–µ–º—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã —Å —Ç–∞—Ä–≥–µ—Ç–æ–º, –Ω–µ–≤–∞–∂–Ω–æ –ø—Ä–∏ –∫–∞–∫–æ–º RMSE. –û—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –ø–ª–∞–≤–∞—é –≤ —Ç–µ–æ—Ä–∏–∏ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å–ø—Ä–∏–Ω—Ç–∞–º —Å –º–∞—à–∏–Ω–Ω—ã–º –æ–±—É—á–µ–Ω–∏–µ–º. –ë—É–¥—É –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω –µ—Å–ª–∏ —Å–º–æ–¥–µ—à—å –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å.

# ## –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

# –ü–æ—Å—Ç–∞–≤—å—Ç–µ 'x' –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–∞—Ö. –î–∞–ª–µ–µ –Ω–∞–∂–º–∏—Ç–µ Shift+Enter.

# - [x]  Jupyter Notebook –æ—Ç–∫—Ä—ã—Ç
# - [x]  –í–µ—Å—å –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
# - [x]  –Ø—á–µ–π–∫–∏ —Å –∫–æ–¥–æ–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
# - [x]  –í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥ 1: –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã
# - [x]  –í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥ 2: –º–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
#     - [x]  –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—É—é –≤—ã–±–æ—Ä–∫–∏
#     - [x]  –ú–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω—ã, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Å–¥–µ–ª–∞–Ω—ã
#     - [x]  –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
#     - [x]  –ù–∞ —ç–∫—Ä–∞–Ω–µ –Ω–∞–ø–µ—á–∞—Ç–∞–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
#     - [x]  –°–¥–µ–ª–∞–Ω—ã –≤—ã–≤–æ–¥—ã
# - [x]  –í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥ 3: –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞—Å—á—ë—Ç—É –ø—Ä–∏–±—ã–ª–∏
#     - [x]  –î–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å–æ–∑–¥–∞–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã Python
#     - [x]  –ü–æ—Å—á–∏—Ç–∞–Ω–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è—Ö —Ä–µ–≥–∏–æ–Ω–∞, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
#     - [x]  –ü–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø—É–Ω–∫—Ç—É —Å–¥–µ–ª–∞–Ω—ã –≤—ã–≤–æ–¥—ã
#     - [x]  –ù–∞–ø–∏—Å–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–∏–±—ã–ª–∏
# - [x]  –í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥ 4: –ø–æ—Å—á–∏—Ç–∞–Ω—ã —Ä–∏—Å–∫–∏ –∏ –ø—Ä–∏–±—ã–ª—å
#     - [x]  –ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ *Bootstrap*
#     - [x]  –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É—Ç—Å—Ç—Ä–µ–ø–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —É—Å–ª–æ–≤–∏—é
#     - [x]  –ù–∞–π–¥–µ–Ω—ã –≤—Å–µ –Ω—É–∂–Ω—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã
#     - [x]  –ü—Ä–µ–¥–ª–æ–∂–µ–Ω —Ä–µ–≥–∏–æ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è
#     - [x]  –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–∞ –æ–±–æ—Å–Ω–æ–≤–∞–Ω

# In[ ]:




